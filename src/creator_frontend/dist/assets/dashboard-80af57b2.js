import{r as n,j as e,C as r,L as w,B as N}from"./index-43d0fa9b.js";import{c as d}from"./index-d5840571.js";import{S as k}from"./Spinner-c61f8477.js";import{A as S}from"./Alert-294d6ed2.js";import{T as b}from"./Table-ed804b5b.js";import"./CloseButton-102e4345.js";const L=()=>{const[h,u]=n.useState([]),[a,p]=n.useState(null),[f,i]=n.useState(!0),[x,c]=n.useState("");return n.useEffect(()=>{(async()=>{i(!0),c("");try{const s=localStorage.getItem("user"),o=JSON.parse(s);if(!o){c("No logged-in user found. Please log in."),i(!1);return}const m=await d.getClientById(Number(o.id));m&&p(m[0]);const y=await d.getPaymentsByClient(Number(o.id)),g=await Promise.all(y.map(async j=>{const l=await d.getArtworkDetails(Number(j.artwork_id));return{...j,artwork_name:l?`${l[0].artwork_id} - ${l[0].title}`:"Unknown Artwork"}}));u(g)}catch(s){console.error("Failed to fetch payments:",s),c("Could not fetch payments. Please try again later.")}finally{i(!1)}})()},[]),e.jsx("div",{children:f?e.jsx("div",{className:"text-center",children:e.jsx(k,{animation:"border",variant:"primary"})}):x?e.jsx(S,{variant:"danger",className:"text-center",children:x}):e.jsxs("div",{children:[a&&e.jsxs(r,{className:"mb-4",children:[e.jsx(r.Header,{children:e.jsx(r.Title,{as:"h5",children:"Logged in Client Info"})}),e.jsxs(r.Body,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",a.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",a.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone Number:"})," ",a.phone_number]})]})]}),e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsx(r.Title,{as:"h5",children:"Recent Payments"})}),e.jsxs(r.Body,{children:[e.jsxs(b,{responsive:!0,hover:!0,striped:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Artwork Name"}),e.jsx("th",{children:"Amount (Frw)"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Transaction ID"})," ",e.jsx("th",{children:"Transaction Reference"})," "]})}),e.jsx("tbody",{children:h.length>0?h.slice(-3).map((t,s)=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:s+1}),e.jsx("td",{children:t.artwork_name})," ",e.jsxs("td",{children:[Number(t.amount).toLocaleString()," Frw"]}),e.jsx("td",{children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{children:t.payment_status}),e.jsx("td",{children:t.tx_id})," ",e.jsx("td",{children:t.tx_ref})," "]},t.payment_id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center",children:"No payments found."})})})]}),e.jsx("div",{className:"text-center",children:e.jsx(w,{to:"/client/mypayments",children:e.jsx(N,{variant:"primary",children:"View More"})})})]})]})]})})};export{L as default};
